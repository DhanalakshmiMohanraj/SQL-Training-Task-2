-- Create database
DROP DATABASE IF EXISTS payroll_database;
CREATE DATABASE payroll_database;
USE payroll_database;

-- Create table
CREATE TABLE employees (
    EMPLOYEE_ID SERIAL PRIMARY KEY,
    NAME VARCHAR(100) NOT NULL,
    DEPARTMENT VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(255) UNIQUE NOT NULL,
    PHONE_NO NUMERIC(10,0) UNIQUE NOT NULL,
    JOINING_DATE DATE NOT NULL,
    SALARY NUMERIC(10,2) NOT NULL,
    BONUS NUMERIC(10,2) DEFAULT 0,
    TAX_PERCENTAGE NUMERIC(5,2) NOT NULL
);

-- Insert data
INSERT INTO employees (NAME, DEPARTMENT, EMAIL, PHONE_NO, JOINING_DATE, SALARY, BONUS, TAX_PERCENTAGE) VALUES
    ('John Doe', 'Sales', 'john.doe@example.com', 1234567890, '2024-01-15', 75000, 5000, 20),
    ('Chris Taylor', 'IT', 'chris.taylor@example.com', 1234567896, '2024-04-01', 88000, 6500, 24),
    ('Lisa Anderson', 'Marketing', 'lisa.anderson@example.com', 1234567897, '2023-10-15', 82000, 6200, 23),
    ('Tom Harris', 'Finance', 'tom.harris@example.com', 1234567898, '2024-01-02', 92000, 9500, 25),
    ('Rachel Green', 'HR', 'rachel.green@example.com', 1234567899, '2023-08-01', 75000, 4500, 19);


SELECT * FROM employees 
ORDER BY SALARY DESC;

SELECT 
    EMPLOYEE_ID,
    NAME,
    DEPARTMENT,
    SALARY,
    BONUS,
    (SALARY + BONUS) as TOTAL_COMPENSATION
FROM employees 
WHERE (SALARY + BONUS) > 100000;

UPDATE employees 
SET BONUS = BONUS * 1.1 
WHERE DEPARTMENT = 'Sales' 
AND EMPLOYEE_ID > 0;

SELECT 
    EMPLOYEE_ID, 
    NAME, 
    DEPARTMENT,
    SALARY, 
    BONUS, 
    TAX_PERCENTAGE, 
    ROUND((SALARY + BONUS) * (1 - TAX_PERCENTAGE/100), 2) as NET_SALARY
FROM employees;

SELECT 
    DEPARTMENT, 
    ROUND(AVG(SALARY), 2) as AVG_SALARY,
    MIN(SALARY) as MIN_SALARY,
    MAX(SALARY) as MAX_SALARY
FROM employees
GROUP BY DEPARTMENT
ORDER BY AVG_SALARY DESC;

SELECT 
    EMPLOYEE_ID,
    NAME,
    DEPARTMENT,
    JOINING_DATE
FROM employees 
WHERE JOINING_DATE > DATE_SUB(CURRENT_DATE, INTERVAL 6 MONTH)
ORDER BY JOINING_DATE DESC;

SELECT 
    DEPARTMENT, 
    COUNT(*) as EMPLOYEE_COUNT
FROM employees
GROUP BY DEPARTMENT
ORDER BY EMPLOYEE_COUNT DESC;

SELECT 
    DEPARTMENT, 
    ROUND(AVG(SALARY), 2) as AVG_SALARY
FROM employees
GROUP BY DEPARTMENT
ORDER BY AVG_SALARY DESC
LIMIT 1;

SELECT 
    e1.EMPLOYEE_ID, 
    e1.NAME, 
    e1.DEPARTMENT,
    e1.SALARY
FROM employees e1
INNER JOIN employees e2 
    ON e1.SALARY = e2.SALARY 
    AND e1.EMPLOYEE_ID != e2.EMPLOYEE_ID
GROUP BY e1.EMPLOYEE_ID, e1.NAME, e1.DEPARTMENT, e1.SALARY
ORDER BY e1.SALARY DESC;
